[ 2025.4.17更新 ]
## RocketMQ 面试学习线路（七大阶段）

### 目标：系统掌握 RocketMQ 的核心架构、消息收发机制、可靠性保障、高可用原理与事务设计，提升面试表现力和系统思维能力。

---

## 第一阶段：RocketMQ 基础认知

**目标：理解 RocketMQ 的设计定位、应用场景与架构特色**

### 1. 什么是 RocketMQ？
- 阿里开源、高性能、分布式消息中间件
- 支持发布/订阅、顺序消息、延迟消息、事务消息

### 2. 核心应用场景
- 分布式事务（下单扣库存）
- 系统解耦（微服务通信）
- 异步处理（短信、推送）
- 流量削峰（秒杀）

### 3. RocketMQ 架构组件
- Producer：消息生产者
- Broker：消息中转节点（支持主从）
- Consumer：消息消费者
- NameServer：路由注册中心
- Topic / Queue / Message / Tag 概念

---

## 第二阶段：消息发送与消费流程

**目标：掌握消息从 Producer 到 Consumer 的全流程机制**

### 1. 消息发送流程
- Producer 从 NameServer 获取路由 → Broker 写入 CommitLog → 分发到 ConsumeQueue → 存储到 IndexFile

### 2. 消费流程
- Pull 模型（拉取式消费）
- ConsumerGroup 与 Rebalance 机制（集群模式、广播模式）

### 3. 消费位置存储（Offset）
- 集群消费：Broker 端记录 offset
- 广播消费：客户端记录 offset

### 4. 面试题
- RocketMQ 是推模式还是拉模式？
- 消费失败会怎么办？消息会丢失吗？

---

## 第三阶段：消息顺序、重复与幂等性

**目标：掌握顺序消息与消息幂等的核心逻辑与处理策略**

### 1. 顺序消息机制
- 同一个消息队列保证顺序
- 顺序消费需控制 Hash 选择队列

### 2. 消息重复的原因
- 消费失败重试导致重复
- 异常场景 Producer 超时但消息已发送成功

### 3. 幂等性设计
- 消费端业务幂等（唯一业务 ID + 去重表）
- 数据库主键/唯一索引限制重复插入

### 4. 面试题
- 如何保证消息幂等？
- 顺序消息是如何实现的？有没有副作用？

---

## 第四阶段：消息可靠性与重试机制

**目标：理解消息可靠传输与异常恢复能力**

### 1. 消息投递可靠性
- 发送确认机制：同步发送、异步发送、单向发送
- 同步发送可确保可靠性（失败可重发）

### 2. 消费重试机制
- 消费失败后自动重试（默认最多重试 16 次）
- 死信队列（DLQ）：达到最大重试次数后投递

### 3. 消息丢失场景与解决
- Broker 宕机 → 开启同步刷盘 + 主从同步
- 客户端宕机 → 保留 offset、避免 ACK 丢失

### 4. 面试高频题
- RocketMQ 会丢消息吗？如何保证不丢？
- 死信队列的使用场景？

---

## 第五阶段：延迟消息与事务消息

**目标：掌握高级特性如定时投递与事务控制机制**

### 1. 延迟消息
- 支持 18 个固定等级（不能任意时间）
- 适用于订单关闭、自动提醒等业务

### 2. 事务消息原理
- 半消息（prepare 消息） → 本地事务执行 → commit/rollback
- RocketMQ 主动回查本地事务状态

### 3. 面试题
- 延迟消息可以精确到毫秒吗？
- RocketMQ 的事务消息如何实现的？和本地事务怎么保证一致性？

---

## 第六阶段：高可用与主从同步机制

**目标：理解 RocketMQ 的容灾架构与主从同步模型**

### 1. NameServer 的高可用
- 多个 NameServer，Producer/Consumer 随机连接（无状态）

### 2. Broker 主从机制
- 主从异步复制（默认）或同步复制（更高可靠性）
- 高可用保障消息不丢，但会影响吞吐量

### 3. 面试考点
- 如果主 Broker 宕机，消费者还能消费吗？
- RocketMQ 如何实现主从同步？会有数据不一致吗？

---

## 第七阶段：面试高频题整理

**目标：强化面试答题表达力，掌握 RocketMQ 核心考点**

### 高频问题汇总（建议准备回答思路）：
1. RocketMQ 的整体架构与核心组件？
2. 消息如何保证投递的可靠性？
3. RocketMQ 如何实现顺序消息？对吞吐有影响吗？
4. RocketMQ 是如何实现事务消息的？
5. 消息重复怎么处理？如何保证幂等？
6. 消费失败的消息如何处理？有死信队列吗？
7. RocketMQ 是推送模式还是拉取模式？
8. Broker 和 NameServer 分别负责什么？
9. 如何设置延迟消息？能否做到毫秒级别？
10. 主从 Broker 宕机会发生什么？能自动切换吗？

---

## 附录：学习资料与实践建议

### 推荐资料
- [RocketMQ 官方文档](https://rocketmq.apache.org/)
- 《RocketMQ 技术内幕》
- 开源代码仓库：阿里 RocketMQ 示例项目
- B站：RocketMQ 实战课程（推荐看发送/消费与事务讲解）

### 实战建议
- 亲手搭建 RocketMQ 集群（带主从结构）
- 编写 Producer + Consumer Demo，实现顺序消息 +重试处理
- 模拟宕机、丢包等异常场景做观察和总结
